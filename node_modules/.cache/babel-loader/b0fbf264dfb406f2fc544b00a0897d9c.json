{"ast":null,"code":"import _regeneratorRuntime from \"/Users/samet/myproject/myproject/ibet-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/samet/myproject/myproject/ibet-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/samet/myproject/myproject/ibet-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/samet/myproject/myproject/ibet-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/samet/myproject/myproject/ibet-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/samet/myproject/myproject/ibet-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/samet/myproject/myproject/ibet-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/samet/myproject/myproject/ibet-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/samet/myproject/myproject/ibet-web/src/components/change_email.js\";\nimport React, { Component } from 'react';\nimport { config } from \"../util_config\";\nimport axios from 'axios';\nimport { withRouter } from 'react-router-dom';\nimport { FormattedMessage } from 'react-intl';\nimport { errors } from './errors'; //const API_URL = process.env.REACT_APP_REST_API;\n\nvar API_URL = 'http://52.9.147.67:8080/';\n\nvar Change_Email =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Change_Email, _Component);\n\n  function Change_Email(props) {\n    var _this;\n\n    _classCallCheck(this, Change_Email);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Change_Email).call(this, props));\n    _this.state = {\n      new_email: '',\n      confirm_email: '',\n      errorCode: '',\n      fetched_data: {},\n      live_check_email: false,\n      live_check_email_match: false,\n      email_existed_error: false,\n      button_disable: true\n    };\n    _this.onInputChange_new_email = _this.onInputChange_new_email.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.onInputChange_confirm_email = _this.onInputChange_confirm_email.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.onFormSubmit = _this.onFormSubmit.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(Change_Email, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var _this2 = this;\n\n        var token;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                token = localStorage.getItem('token');\n                config.headers[\"Authorization\"] = \"Token \".concat(token);\n                _context.next = 4;\n                return axios.get(API_URL + 'users/api/user/', config).then(function (res) {\n                  _this2.setState({\n                    fetched_data: res.data\n                  });\n                });\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"onInputChange_new_email\",\n    value: function onInputChange_new_email(event) {\n      var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n\n      if (!event.target.value.match(re)) {\n        this.setState({\n          live_check_email: true,\n          button_disable: true\n        });\n      } else {\n        this.setState({\n          live_check_email: false\n        });\n        this.check_button_disable();\n      }\n\n      if (this.state.confirm_email) {\n        if (this.state.confirm_email !== event.target.value) {\n          this.setState({\n            live_check_email_match: true,\n            button_disable: true\n          });\n        }\n      }\n\n      if (this.state.confirm_email === event.target.value && event.target.value.match(re)) {\n        this.setState({\n          button_disable: false,\n          live_check_email_match: false\n        });\n      }\n\n      this.setState({\n        new_email: event.target.value\n      });\n    }\n  }, {\n    key: \"onInputChange_confirm_email\",\n    value: function onInputChange_confirm_email(event) {\n      var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n\n      if (this.state.new_email !== event.target.value) {\n        this.setState({\n          live_check_email_match: true,\n          button_disable: true\n        });\n      } else if (!event.target.value.match(re)) {\n        this.setState({\n          button_disable: true\n        });\n\n        if (this.state.new_email === event.target.value) {\n          this.setState({\n            live_check_email_match: false\n          });\n        }\n      } else {\n        this.setState({\n          live_check_email_match: false,\n          button_disable: false\n        });\n      }\n\n      this.setState({\n        confirm_email: event.target.value\n      });\n    }\n  }, {\n    key: \"check_button_disable\",\n    value: function check_button_disable() {\n      if (!this.live_check_email && this.state.new_email && this.state.confirm_email && this.state.confirm_email === this.state.new_email) {\n        this.setState({\n          button_disable: false\n        });\n      }\n    }\n  }, {\n    key: \"onFormSubmit\",\n    value: function onFormSubmit(event) {\n      var _this3 = this;\n\n      event.preventDefault();\n      this.setState({\n        email_existed_error: false\n      });\n      var token = localStorage.getItem('token');\n      config.headers[\"Authorization\"] = \"Token \".concat(token);\n      axios.post(API_URL + \"users/api/updateemail/\", {\n        old_email: this.state.fetched_data.email,\n        new_email: this.state.new_email\n      }, config).then(function (res) {\n        if (res.data === 'Duplicate') {\n          _this3.setState({\n            email_existed_error: true\n          });\n        } else {\n          axios.get(API_URL + \"users/api/sendemail/?case=change_email&to_email_address=\".concat(_this3.state.fetched_data.email, \"&email=\").concat(_this3.state.new_email), config).then(function (res) {\n            axios.get(API_URL + \"users/api/sendemail/?case=change_email&to_email_address=\".concat(_this3.state.new_email, \"&&email=\").concat(_this3.state.new_email), config);\n          });\n\n          _this3.props.history.push(\"/profile\");\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var showErrors = function showErrors() {\n        if (_this4.state.errorCode === errors.EMAIL_NOT_MATCH) {\n          return React.createElement(\"div\", {\n            style: {\n              color: 'red'\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 116\n            },\n            __self: this\n          }, React.createElement(FormattedMessage, {\n            id: \"change_email.email_not_match\",\n            defaultMessage: \"Email does not match\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 117\n            },\n            __self: this\n          }));\n        } else if (_this4.state.errorCode === errors.EMAIL_CAN_NOT_BE_SAME) {\n          return React.createElement(\"div\", {\n            style: {\n              color: 'red'\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 122\n            },\n            __self: this\n          }, React.createElement(FormattedMessage, {\n            id: \"change_email.email_can_not_be_same\",\n            defaultMessage: \"New email address has to be different from the old email address\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 123\n            },\n            __self: this\n          }));\n        }\n      };\n\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129\n        },\n        __self: this\n      }, React.createElement(\"form\", {\n        onSubmit: this.onFormSubmit,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133\n        },\n        __self: this\n      }, React.createElement(\"b\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133\n        },\n        __self: this\n      }, React.createElement(FormattedMessage, {\n        id: \"change_email.enter_email\",\n        defaultMessage: \"New Email address: \",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134\n        },\n        __self: this\n      }))), React.createElement(\"input\", {\n        placeholder: \"example@gmail.com\",\n        className: \"form-control\",\n        value: this.state.new_email,\n        onChange: this.onInputChange_new_email,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136\n        },\n        __self: this\n      })), this.state.live_check_email && React.createElement(\"div\", {\n        style: {\n          color: 'red'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      }, \" \", React.createElement(FormattedMessage, {\n        id: \"error.email\",\n        defaultMessage: \"Email address not valid\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      }), \" \"), this.state.email_existed_error && React.createElement(\"div\", {\n        style: {\n          color: 'red'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146\n        },\n        __self: this\n      }, \" \", React.createElement(FormattedMessage, {\n        id: \"referral.email_exist\",\n        defaultMessage: \"This email has already been registerd\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146\n        },\n        __self: this\n      }), \" \"), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148\n        },\n        __self: this\n      }, React.createElement(\"label\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149\n        },\n        __self: this\n      }, React.createElement(\"b\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 149\n        },\n        __self: this\n      }, React.createElement(FormattedMessage, {\n        id: \"change_email.confirm_email\",\n        defaultMessage: \"Confirm Email address: \",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150\n        },\n        __self: this\n      }))), React.createElement(\"input\", {\n        placeholder: \"example@gmail.com\",\n        className: \"form-control\",\n        value: this.state.confirm_email,\n        onChange: this.onInputChange_confirm_email,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152\n        },\n        __self: this\n      })), this.state.live_check_email_match && React.createElement(\"div\", {\n        style: {\n          color: 'red'\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      }, \" \", React.createElement(FormattedMessage, {\n        id: \"change_email.email_not_match\",\n        defaultMessage: \"Email does not match\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      }), \"  \"), React.createElement(\"span\", {\n        className: \"input-group-btn\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        disabled: this.state.button_disable,\n        type: \"submit\",\n        className: \"btn btn-secondary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163\n        },\n        __self: this\n      }, React.createElement(FormattedMessage, {\n        id: \"change_email.sumbit\",\n        defaultMessage: \"Submit\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164\n        },\n        __self: this\n      }))), React.createElement(\"button\", {\n        style: {\n          color: 'red'\n        },\n        onClick: function onClick() {\n          _this4.props.history.push(\"/update_profile\");\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168\n        },\n        __self: this\n      }, React.createElement(FormattedMessage, {\n        id: \"change_email.cancel\",\n        defaultMessage: \"Cancel\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169\n        },\n        __self: this\n      }))), showErrors());\n    }\n  }]);\n\n  return Change_Email;\n}(Component);\n\nexport default withRouter(Change_Email);","map":{"version":3,"sources":["/Users/samet/myproject/myproject/ibet-web/src/components/change_email.js"],"names":["React","Component","config","axios","withRouter","FormattedMessage","errors","API_URL","Change_Email","props","state","new_email","confirm_email","errorCode","fetched_data","live_check_email","live_check_email_match","email_existed_error","button_disable","onInputChange_new_email","bind","onInputChange_confirm_email","onFormSubmit","token","localStorage","getItem","headers","get","then","res","setState","data","event","re","target","value","match","check_button_disable","preventDefault","post","old_email","email","history","push","showErrors","EMAIL_NOT_MATCH","color","EMAIL_CAN_NOT_BE_SAME"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { config } from \"../util_config\";\nimport axios from 'axios';\nimport { withRouter } from 'react-router-dom';\nimport { FormattedMessage } from 'react-intl';\nimport { errors } from './errors';\n\n\n//const API_URL = process.env.REACT_APP_REST_API;\nconst API_URL = 'http://52.9.147.67:8080/';\n\nclass Change_Email extends Component {\n    constructor(props){\n        super(props);\n        \n        this.state = {\n            new_email: '',\n            confirm_email: '',\n            errorCode: '',\n            fetched_data: {},\n\n            live_check_email: false,\n            live_check_email_match: false,\n\n            email_existed_error: false,\n\n            button_disable: true\n        }\n\n        this.onInputChange_new_email     = this.onInputChange_new_email.bind(this);\n        this.onInputChange_confirm_email = this.onInputChange_confirm_email.bind(this);\n        this.onFormSubmit                   = this.onFormSubmit.bind(this);\n    }\n\n    async componentDidMount() {\n      const token = localStorage.getItem('token');\n      config.headers[\"Authorization\"] = `Token ${token}`;\n\n      await axios.get(API_URL + 'users/api/user/', config)\n        .then(res => {\n            this.setState({fetched_data: res.data});\n        })\n    }\n\n    onInputChange_new_email(event){\n        var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n        if (!event.target.value.match(re)){\n            this.setState({live_check_email: true, button_disable: true})\n        }else{\n            this.setState({live_check_email: false})\n            this.check_button_disable()\n        }\n        if (this.state.confirm_email){\n            if (this.state.confirm_email !== event.target.value){\n                this.setState({live_check_email_match: true, button_disable: true})\n            }\n        }\n        if (this.state.confirm_email === event.target.value && event.target.value.match(re)){\n            this.setState({ button_disable: false, live_check_email_match: false})\n        }\n        this.setState({new_email: event.target.value});\n    }\n    \n    onInputChange_confirm_email(event){\n        var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n        if (this.state.new_email !== event.target.value){\n            this.setState({live_check_email_match: true, button_disable: true})\n        }else if(!event.target.value.match(re)){\n            this.setState({button_disable: true})\n            if (this.state.new_email === event.target.value){\n                this.setState({live_check_email_match: false})\n            }\n        }else{\n            this.setState({live_check_email_match: false, button_disable: false})\n        }\n        this.setState({confirm_email: event.target.value});\n    }\n\n    check_button_disable(){\n        if (!this.live_check_email && this.state.new_email && this.state.confirm_email && this.state.confirm_email === this.state.new_email){\n          this.setState({button_disable: false})\n        }\n      }\n    \n    onFormSubmit(event){\n        event.preventDefault();\n        \n        this.setState({email_existed_error: false})\n\n        const token = localStorage.getItem('token');\n        config.headers[\"Authorization\"] = `Token ${token}`;\n\n        axios.post(API_URL + `users/api/updateemail/`, {\n            old_email: this.state.fetched_data.email,\n            new_email: this.state.new_email\n        }, config)\n        .then(res => {\n            if (res.data === 'Duplicate'){\n                this.setState({email_existed_error: true})\n            }else{\n                axios.get(API_URL + `users/api/sendemail/?case=change_email&to_email_address=${this.state.fetched_data.email}&email=${this.state.new_email}`, config)\n                .then(res => {\n                    axios.get(API_URL + `users/api/sendemail/?case=change_email&to_email_address=${this.state.new_email}&&email=${this.state.new_email}`, config)\n                })\n                \n                this.props.history.push(\"/profile\");\n            }\n        })\n    }\n    render(){\n\n\n        const showErrors = () => {\n            if (this.state.errorCode === errors.EMAIL_NOT_MATCH) {\n                return (\n                    <div style={{color: 'red'}}> \n                        <FormattedMessage id=\"change_email.email_not_match\" defaultMessage='Email does not match' /> \n                    </div>\n                );\n            } else if (this.state.errorCode === errors.EMAIL_CAN_NOT_BE_SAME) {\n                return (\n                    <div style={{color: 'red'}}> \n                        <FormattedMessage id=\"change_email.email_can_not_be_same\" defaultMessage='New email address has to be different from the old email address' /> \n                    </div>\n                );\n            }\n        }\n        return (\n            <div>\n                <form onSubmit={this.onFormSubmit} >\n\n                    <div>\n                        <label><b>\n                        <FormattedMessage id=\"change_email.enter_email\" defaultMessage='New Email address: ' />    \n                        </b></label>\n                        <input\n                            placeholder=\"example@gmail.com\"\n                            className=\"form-control\"\n                            value={this.state.new_email}\n                            onChange={this.onInputChange_new_email}\n                        />\n                    </div>\n\n                    {this.state.live_check_email && <div style={{color: 'red'}}> <FormattedMessage  id=\"error.email\" defaultMessage='Email address not valid' /> </div>}\n\n                    {this.state.email_existed_error && <div style={{color: 'red'}}> <FormattedMessage  id=\"referral.email_exist\" defaultMessage='This email has already been registerd' /> </div>}\n                    \n                    <div>\n                        <label><b>\n                        <FormattedMessage id=\"change_email.confirm_email\" defaultMessage='Confirm Email address: ' />\n                        </b></label>\n                        <input\n                            placeholder=\"example@gmail.com\"\n                            className=\"form-control\"\n                            value={this.state.confirm_email}\n                            onChange={this.onInputChange_confirm_email}\n                        />\n                    </div>\n\n                    {this.state.live_check_email_match && <div style={{color: 'red'}}> <FormattedMessage id=\"change_email.email_not_match\" defaultMessage='Email does not match' />  </div>}\n\n                    <span className=\"input-group-btn\">\n                        <button disabled = {this.state.button_disable} type=\"submit\" className=\"btn btn-secondary\"> \n                        <FormattedMessage id=\"change_email.sumbit\" defaultMessage='Submit' />    \n                        </button>\n                    </span>\n\n                    <button style={{color: 'red'}} onClick={()=>{this.props.history.push(\"/update_profile\")}}> \n                        <FormattedMessage id=\"change_email.cancel\" defaultMessage='Cancel' />       \n                    </button>\n                </form>\n                {\n                    showErrors()\n                }\n            </div>\n        )\n    }\n}\n\nexport default withRouter(Change_Email);\n"]},"metadata":{},"sourceType":"module"}